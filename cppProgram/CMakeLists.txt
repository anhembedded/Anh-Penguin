cmake_minimum_required(VERSION 3.15)

project(PRACTICE_LINUX VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(CMAKE_C_STANDARD 11)
set(CMAKE_C_STANDARD_REQUIRED ON)

include_directories(/usr/include/c++/13
                    /usr/include)
add_subdirectory(src_1)
add_subdirectory(src_2)
add_subdirectory(src_3)
add_subdirectory(src_4)
add_subdirectory(runProcess)
add_subdirectory(unixSocket)
add_subdirectory(internetSocket)

message(STATUS "üìö Include directories for target 'your_target_name': ${INCLUDE_DIRECTORIES}")

# ====================================================================
# PH·∫¶N C·∫§U H√åNH CPPCHECK - PHI√äN B·∫¢N HYBRID V·ªöI LOG TRACE
# ====================================================================
find_program(CPPCHECK_EXECUTABLE cppcheck REQUIRED)

# --- B∆Ø·ªöC A: L·∫•y c√°c ƒë∆∞·ªùng d·∫´n include ng·∫ßm ƒë·ªãnh c·ªßa h·ªá th·ªëng ---
set(SYSTEM_INCLUDES ${CMAKE_CXX_IMPLICIT_INCLUDE_DIRECTORIES})

# --- LOG TRACE 1: In ra c√°c ƒë∆∞·ªùng d·∫´n h·ªá th·ªëng m√† CMake t√¨m th·∫•y ---
message(STATUS "üîé TRACE: C√°c ƒë∆∞·ªùng d·∫´n include h·ªá th·ªëng ng·∫ßm ƒë·ªãnh (raw):")
message(STATUS "  ==> ${SYSTEM_INCLUDES}")

# --- B∆Ø·ªöC B: Chuy·ªÉn c√°c ƒë∆∞·ªùng d·∫´n ƒë√≥ th√†nh c√°c c·ªù -I ---
set(CPPCHECK_SYS_INCLUDE_FLAGS "")
foreach(DIR ${SYSTEM_INCLUDES})
    list(APPEND CPPCHECK_SYS_INCLUDE_FLAGS "-I${DIR}")
endforeach()

# --- LOG TRACE 2: In ra danh s√°ch c·ªù -I ƒë√£ ƒë∆∞·ª£c t·∫°o ---
message(STATUS "üõ†Ô∏è TRACE: C√°c c·ªù -I h·ªá th·ªëng ƒë∆∞·ª£c t·∫°o cho Cppcheck:")
message(STATUS "  ==> ${CPPCHECK_SYS_INCLUDE_FLAGS}")

# --- B∆Ø·ªöC C: T·∫°o custom target k·∫øt h·ª£p --project v√† -I h·ªá th·ªëng ---
add_custom_target(analyze
    COMMAND ${CPPCHECK_EXECUTABLE}
            --enable=all
            --project=${CMAKE_BINARY_DIR}/compile_commands.json
            ${CPPCHECK_SYS_INCLUDE_FLAGS}
            --library=std.cfg
            --verbose # Gi·ªØ l·∫°i verbose ƒë·ªÉ xem Cppcheck c√≥ nh·∫≠n ƒë∆∞·ª£c kh√¥ng
    COMMENT "‚úÖ Running Cppcheck analysis (Hybrid Mode)..."
)

message(STATUS "üéØ ƒê√£ c·∫•u h√¨nh xong target 'analyze'. Ch·∫°y 'make analyze' ƒë·ªÉ th·ª±c thi.")